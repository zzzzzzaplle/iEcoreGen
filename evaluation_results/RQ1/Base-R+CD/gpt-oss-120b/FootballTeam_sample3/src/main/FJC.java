package com.turgutlu.football;

import java.util.ArrayList;
import java.util.Collections;
import java.util.Date;
import java.util.List;
import java.util.Optional;

/**
 * Represents a football team consisting of players and the announcements generated
 * during a match. It provides operations required by the functional specifications
 * such as counting announcements, finding specific players, and computing averages.
 */
 class FootballTeam {

    /** The starting eleven players (max 11). */
    private List<Player> firstEleven;

    /** The spare (reserve) team players. */
    private List<Player> spareTeam;

    /** All players belonging to the team (including first eleven and spare). */
    private List<Player> players;

    /** All announcements generated during the match. */
    private List<Announcement> announcements;

    /** No‑argument constructor required by the specification. */
    public FootballTeam() {
        this.firstEleven = new ArrayList<>();
        this.spareTeam = new ArrayList<>();
        this.players = new ArrayList<>();
        this.announcements = new ArrayList<>();
    }

    /* --------------------------------------------------------------------- */
    /* Getters and setters for the collection fields (allow test code to add) */
    /* --------------------------------------------------------------------- */

    public List<Player> getFirstEleven() {
        return firstEleven;
    }

    public void setFirstEleven(List<Player> firstEleven) {
        this.firstEleven = firstEleven;
    }

    public List<Player> getSpareTeam() {
        return spareTeam;
    }

    public void setSpareTeam(List<Player> spareTeam) {
        this.spareTeam = spareTeam;
    }

    public List<Player> getPlayers() {
        return players;
    }

    public void setPlayers(List<Player> players) {
        this.players = players;
    }

    public List<Announcement> getAnnouncements() {
        return announcements;
    }

    public void setAnnouncements(List<Announcement> announcements) {
        this.announcements = announcements;
    }

    // ----------------------------------------------------------------------
    // Functional requirement implementations
    // ----------------------------------------------------------------------

    /**
     * Calculates the total number of goal‑scoring announcements (type SCORE) that
     * were issued by the starting eleven players. Only players whose position is
     * {@link Position#FORWARD} are considered.
     *
     * @return the count of SCORE announcements generated by forwards in the first eleven
     */
    public int calculateTotalGoalScoringAnnouncementsForFirstEleven() {
        int count = 0;
        for (Announcement ann : announcements) {
            if (ann.getType() == AnnouncementType.SCORE) {
                Player p = ann.getPlayer();
                if (p != null && firstEleven.contains(p) && p.getPosition() == Position.FORWARD) {
                    count++;
                }
            }
        }
        return count;
    }

    /**
     * Finds the midfielder with the highest jersey number among all players of the
     * team.
     *
     * @return the {@link Player} object representing the midfielder with the highest number,
     *         or {@code null} if no midfielder exists in the team
     */
    public Player findMidfielderWithHighestNumber() {
        Player result = null;
        int highest = Integer.MIN_VALUE;
        for (Player p : players) {
            if (p.getPosition() == Position.MIDFIELD) {
                if (p.getNumber() > highest) {
                    highest = p.getNumber();
                    result = p;
                }
            }
        }
        return result;
    }

    /**
     * Calculates the average age of the players that belong to the spare team.
     *
     * @return the average age as a {@code double}; returns {@code 0.0} if the spare team is empty
     */
    public double calculateAverageAgeOfSpareTeam() {
        if (spareTeam.isEmpty()) {
            return 0.0;
        }
        int totalAge = 0;
        for (Player p : spareTeam) {
            totalAge += p.getAge();
        }
        return (double) totalAge / spareTeam.size();
    }

    /**
     * Counts how many goal‑saving announcements (type SAVE) were made by goalkeepers
     * on the team.
     *
     * @return the number of SAVE announcements generated by players whose position is
     *         {@link Position#GOALKEEPER}
     */
    public int calculateGoalSavingAnnouncementsByGoalkeeper() {
        int count = 0;
        for (Announcement ann : announcements) {
            if (ann.getType() == AnnouncementType.SAVE) {
                Player p = ann.getPlayer();
                if (p != null && p.getPosition() == Position.GOALKEEPER) {
                    count++;
                }
            }
        }
        return count;
    }

    /**
     * Calculates the total number of announcements generated by all forwards on the
     * team, regardless of announcement type.
     *
     * @return the number of announcements where the associated player is a forward;
     *         returns {@code 0} if there are no forwards or no announcements
     */
    public int calculateTotalAnnouncementsForForwardPlayers() {
        int count = 0;
        for (Announcement ann : announcements) {
            Player p = ann.getPlayer();
            if (p != null && p.getPosition() == Position.FORWARD) {
                count++;
            }
        }
        return count;
    }
}

/* -------------------------------------------------------------------------- */
/* Supporting domain classes and enumerations                                   */
/* -------------------------------------------------------------------------- */

/**
 * Enumeration of possible player positions on the field.
 */
enum Position {
    FORWARD,
    MIDFIELD,
    DEFENSE,
    GOALKEEPER
}

/**
 * Represents a football player with basic attributes.
 */
class Player {

    private String name;
    private int age;
    private int number;
    private Position position;

    /** No‑argument constructor. */
    public Player() {
        // default values may stay null / 0
    }

    // ------------------- Getters and Setters -------------------

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    public int getAge() {
        return age;
    }

    public void setAge(int age) {
        this.age = age;
    }

    public int getNumber() {
        return number;
    }

    public void setNumber(int number) {
        this.number = number;
    }

    public Position getPosition() {
        return position;
    }

    public void setPosition(Position position) {
        this.position = position;
    }

    // -----------------------------------------------------------------
    // Optional: convenient toString for debugging / announcement output
    // -----------------------------------------------------------------
    @Override
    public String toString() {
        return "Player{" +
                "name='" + name + '\'' +
                ", age=" + age +
                ", number=" + number +
                ", position=" + position +
                '}';
    }
}

/**
 * Types of announcements that can be generated during a match.
 */
enum AnnouncementType {
    SCORE,
    SAVE
}

/**
 * Represents an announcement generated during a match (e.g., a goal scored
 * or a save made). It contains the time, type and the player involved.
 */
class Announcement {

    private Date time;
    private AnnouncementType type;
    private Player player;

    /** No‑argument constructor. */
    public Announcement() {
        // default values remain null
    }

    // ------------------- Getters and Setters -------------------

    public Date getTime() {
        return time;
    }

    public void setTime(Date time) {
        this.time = time;
    }

    public AnnouncementType getType() {
        return type;
    }

    public void setType(AnnouncementType type) {
        this.type = type;
    }

    public Player getPlayer() {
        return player;
    }

    public void setPlayer(Player player) {
        this.player = player;
    }

    // -----------------------------------------------------------------
    // Optional: convenient toString for debugging
    // -----------------------------------------------------------------
    @Override
    public String toString() {
        return "Announcement{" +
                "time=" + time +
                ", type=" + type +
                ", player=" + (player != null ? player.getName() : "null") +
                '}';
    }
}