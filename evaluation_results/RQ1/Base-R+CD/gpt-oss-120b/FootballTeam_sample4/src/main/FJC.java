package com.turgutlu.football;

import java.util.ArrayList;
import java.util.Date;
import java.util.List;
import java.util.Optional;
import java.util.stream.Collectors;

/**
 * Represents a football team with its players, first‑eleven lineup,
 * spare (reserve) team and the announcements generated during a match.
 */
 class FootballTeam {

    /** Players that start the match (maximum 11). */
    private List<Player> firstEleven;

    /** Players that are on the reserve bench. */
    private List<Player> spareTeam;

    /** All players belonging to the club (firstEleven + spareTeam + others). */
    private List<Player> players;

    /** All announcements (goals, saves, …) that occurred during the match. */
    private List<Announcement> announcements;

    /** Default no‑arg constructor – creates empty collections. */
    public FootballTeam() {
        this.firstEleven = new ArrayList<>();
        this.spareTeam = new ArrayList<>();
        this.players = new ArrayList<>();
        this.announcements = new ArrayList<>();
    }

    /* -------------------------------------------------------------
       Getters and Setters
       ------------------------------------------------------------- */

    public List<Player> getFirstEleven() {
        return firstEleven;
    }

    public void setFirstEleven(List<Player> firstEleven) {
        this.firstEleven = firstEleven;
    }

    public List<Player> getSpareTeam() {
        return spareTeam;
    }

    public void setSpareTeam(List<Player> spareTeam) {
        this.spareTeam = spareTeam;
    }

    public List<Player> getPlayers() {
        return players;
    }

    public void setPlayers(List<Player> players) {
        this.players = players;
    }

    public List<Announcement> getAnnouncements() {
        return announcements;
    }

    public void setAnnouncements(List<Announcement> announcements) {
        this.announcements = announcements;
    }

    /* -------------------------------------------------------------
       Functional requirements implementation
       ------------------------------------------------------------- */

    /**
     * Calculates the total number of goal‑scoring announcements (type SCORE)
     * issued by the starting eleven players. Only forwards can generate such
     * announcements; announcements from other positions are ignored.
     *
     * @return the number of SCORE announcements belonging to forward players
     *         that are part of the firstEleven list.
     */
    public int calculateTotalGoalScoringAnnouncementsForFirstEleven() {
        // Build a set of IDs (or references) for quick lookup of first‑eleven players.
        List<Player> starters = this.firstEleven != null ? this.firstEleven : new ArrayList<>();

        return (int) this.announcements.stream()
                .filter(a -> a.getType() == AnnouncementType.SCORE)
                .filter(a -> a.getPlayer() != null && a.getPlayer().getPosition() == Position.FORWARD)
                .filter(a -> starters.contains(a.getPlayer()))
                .count();
    }

    /**
     * Finds the midfielder with the highest jersey number among all players of the team.
     *
     * @return the {@link Player} instance representing the midfielder with the greatest
     *         number, or {@code null} if the team has no midfielders.
     */
    public Player findMidfielderWithHighestNumber() {
        return this.players.stream()
                .filter(p -> p.getPosition() == Position.MIDFIELD)
                .max((p1, p2) -> Integer.compare(p1.getNumber(), p2.getNumber()))
                .orElse(null);
    }

    /**
     * Calculates the average age of the spare (reserve) team players.
     *
     * @return the average age as a {@code double}; returns {@code 0.0}
     *         when the spare team list is empty.
     */
    public double calculateAverageAgeOfSpareTeam() {
        List<Player> reserves = this.spareTeam != null ? this.spareTeam : new ArrayList<>();
        if (reserves.isEmpty()) {
            return 0.0;
        }
        double sum = reserves.stream()
                .mapToInt(Player::getAge)
                .sum();
        return sum / reserves.size();
    }

    /**
     * Counts the number of goal‑saving announcements (type SAVE) made by all goalkeepers
     * on the team.
     *
     * @return the total number of SAVE announcements generated by players whose
     *         position is {@link Position#GOALKEEPER}. Returns {@code 0} if none exist.
     */
    public int calculateGoalSavingAnnouncementsByGoalkeeper() {
        return (int) this.announcements.stream()
                .filter(a -> a.getType() == AnnouncementType.SAVE)
                .filter(a -> a.getPlayer() != null && a.getPlayer().getPosition() == Position.GOALKEEPER)
                .count();
    }

    /**
     * Calculates the total number of announcements generated by all forward players
     * (regardless of announcement type).
     *
     * @return the count of announcements whose associated player has a position of
     *         {@link Position#FORWARD}. Returns {@code 0} if there are no forwards
     *         or no announcements.
     */
    public int calculateTotalAnnouncementsForForwardPlayers() {
        return (int) this.announcements.stream()
                .filter(a -> a.getPlayer() != null && a.getPlayer().getPosition() == Position.FORWARD)
                .count();
    }

    /* -------------------------------------------------------------
       Convenience methods (not required but helpful)
       ------------------------------------------------------------- */

    /**
     * Adds a player to the global player list.
     *
     * @param player the player to add
     */
    public void addPlayer(Player player) {
        if (player != null) {
            this.players.add(player);
        }
    }

    /**
     * Adds an announcement to the team's announcement list.
     *
     * @param announcement the announcement to add
     */
    public void addAnnouncement(Announcement announcement) {
        if (announcement != null) {
            this.announcements.add(announcement);
        }
    }
}

/**
 * Enumeration of football player positions.
 */
enum Position {
    FORWARD,
    MIDFIELD,
    DEFENSE,
    GOALKEEPER
}

/**
 * Represents a football player with basic attributes.
 */
class Player {

    private String name;
    private int age;
    private int number;
    private Position position;

    /** Default constructor. */
    public Player() {
        // fields left with default values (null / 0)
    }

    /* -------------------------------------------------------------
       Getters and Setters
       ------------------------------------------------------------- */

    /**
     * Returns the player's name.
     *
     * @return player name
     */
    public String getName() {
        return name;
    }

    /**
     * Sets the player's name.
     *
     * @param name the name to assign
     */
    public void setName(String name) {
        this.name = name;
    }

    /**
     * Returns the player's age.
     *
     * @return player age
     */
    public int getAge() {
        return age;
    }

    /**
     * Sets the player's age.
     *
     * @param age the age to assign
     */
    public void setAge(int age) {
        this.age = age;
    }

    /**
     * Returns the player's jersey number.
     *
     * @return jersey number
     */
    public int getNumber() {
        return number;
    }

    /**
     * Sets the player's jersey number.
     *
     * @param number the number to assign
     */
    public void setNumber(int number) {
        this.number = number;
    }

    /**
     * Returns the player's position.
     *
     * @return position enum value
     */
    public Position getPosition() {
        return position;
    }

    /**
     * Sets the player's position.
     *
     * @param position the position to assign
     */
    public void setPosition(Position position) {
        this.position = position;
    }
}

/**
 * Types of announcements that can occur during a match.
 */
enum AnnouncementType {
    SCORE,
    SAVE
}

/**
 * Represents an announcement generated during a match (e.g., a goal or a save).
 */
class Announcement {

    private Date time;
    private AnnouncementType type;
    private Player player;

    /** Default constructor. */
    public Announcement() {
        // fields left with default values (null)
    }

    /* -------------------------------------------------------------
       Getters and Setters
       ------------------------------------------------------------- */

    /**
     * Returns the timestamp of the announcement.
     *
     * @return announcement time
     */
    public Date getTime() {
        return time;
    }

    /**
     * Sets the timestamp of the announcement.
     *
     * @param time the time to assign
     */
    public void setTime(Date time) {
        this.time = time;
    }

    /**
     * Returns the type of the announcement (SCORE or SAVE).
     *
     * @return announcement type
     */
    public AnnouncementType getType() {
        return type;
    }

    /**
     * Sets the type of the announcement.
     *
     * @param type the type to assign
     */
    public void setType(AnnouncementType type) {
        this.type = type;
    }

    /**
     * Returns the player related to this announcement.
     *
     * @return the player who caused the announcement
     */
    public Player getPlayer() {
        return player;
    }

    /**
     * Sets the player related to this announcement.
     *
     * @param player the player to associate with the announcement
     */
    public void setPlayer(Player player) {
        this.player = player;
    }
}