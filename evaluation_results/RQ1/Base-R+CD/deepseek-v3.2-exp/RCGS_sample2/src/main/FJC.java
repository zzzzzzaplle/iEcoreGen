import java.util.*;
import java.util.stream.Collectors;

/**
 * Represents a car rental store system that manages cars, rentals, and customers.
 */
 class Store {
    private List<Car> cars;
    private List<Rental> rentals;
    private List<OverdueNotice> notices;
    
    /**
     * Default constructor initializes empty lists for cars, rentals, and notices.
     */
    public Store() {
        this.cars = new ArrayList<>();
        this.rentals = new ArrayList<>();
        this.notices = new ArrayList<>();
    }
    
    // Getters and setters
    public List<Car> getCars() { return cars; }
    public void setCars(List<Car> cars) { this.cars = cars; }
    
    public List<Rental> getRentals() { return rentals; }
    public void setRentals(List<Rental> rentals) { this.rentals = rentals; }
    
    public List<OverdueNotice> getNotices() { return notices; }
    public void setNotices(List<OverdueNotice> notices) { this.notices = notices; }
    
    /**
     * Identifies available cars in the store sorted by daily price in ascending order.
     * A car is available if it is not currently rented.
     * 
     * @return List of available cars sorted by daily price, empty list if no available cars exist
     */
    public List<Car> identifyAvailableCars() {
        Set<Car> rentedCars = rentals.stream()
            .filter(rental -> rental.getBackDate() == null)
            .map(Rental::getCar)
            .collect(Collectors.toSet());
            
        return cars.stream()
            .filter(car -> !rentedCars.contains(car))
            .sorted(Comparator.comparingDouble(Car::getDailyPrice))
            .collect(Collectors.toList());
    }
    
    /**
     * Calculates the total revenue generated by all completed rentals in the store.
     * 
     * @return Total revenue from all rentals where back date is not null
     */
    public double calculateTotalRevenue() {
        return rentals.stream()
            .filter(rental -> rental.getBackDate() != null)
            .mapToDouble(Rental::getTotalPrice)
            .sum();
    }
    
    /**
     * Finds customers with overdue rentals based on current date.
     * A rental is overdue if back date is null and current date is past due date.
     * 
     * @param currentDate The current date to check against due dates
     * @return List of customers with overdue rentals, empty list if none exist
     */
    public List<Customer> findCustomersWithOverdueRentals(Date currentDate) {
        return rentals.stream()
            .filter(rental -> rental.getBackDate() == null)
            .filter(rental -> currentDate.after(rental.getDueDate()))
            .map(Rental::getCustomer)
            .distinct()
            .collect(Collectors.toList());
    }
    
    /**
     * Determines the average daily price of all cars in the store.
     * 
     * @return Average daily price of all cars, 0.0 if store has no cars
     */
    public double determineAverageDailyPrice() {
        if (cars.isEmpty()) {
            return 0.0;
        }
        
        double totalPrice = cars.stream()
            .mapToDouble(Car::getDailyPrice)
            .sum();
            
        return totalPrice / cars.size();
    }
    
    /**
     * Counts the number of cars rented per customer.
     * 
     * @return Map containing customers and their rental counts, empty map if no rentals exist
     */
    public Map<Customer, Integer> countCarsRentedPerCustomer() {
        return rentals.stream()
            .collect(Collectors.groupingBy(
                Rental::getCustomer,
                Collectors.collectingAndThen(
                    Collectors.counting(),
                    Long::intValue
                )
            ));
    }
}

/**
 * Represents a car available for rental in the store.
 */
class Car {
    private String plate;
    private String model;
    private double dailyPrice;
    
    /**
     * Default constructor.
     */
    public Car() {}
    
    // Getters and setters
    public String getPlate() { return plate; }
    public void setPlate(String plate) { this.plate = plate; }
    
    public String getModel() { return model; }
    public void setModel(String model) { this.model = model; }
    
    public double getDailyPrice() { return dailyPrice; }
    public void setDailyPrice(double dailyPrice) { this.dailyPrice = dailyPrice; }
}

/**
 * Represents a customer who can rent cars from the store.
 */
class Customer {
    private String name;
    private String surname;
    private String address;
    private String rentedCarPlate;
    
    /**
     * Default constructor.
     */
    public Customer() {}
    
    // Getters and setters
    public String getName() { return name; }
    public void setName(String name) { this.name = name; }
    
    public String getSurname() { return surname; }
    public void setSurname(String surname) { this.surname = surname; }
    
    public String getAddress() { return address; }
    public void setAddress(String address) { this.address = address; }
    
    public String getRentedCarPlate() { return rentedCarPlate; }
    public void setRentedCarPlate(String rentedCarPlate) { this.rentedCarPlate = rentedCarPlate; }
    
    @Override
    public boolean equals(Object o) {
        if (this == o) return true;
        if (o == null || getClass() != o.getClass()) return false;
        Customer customer = (Customer) o;
        return Objects.equals(name, customer.name) &&
               Objects.equals(surname, customer.surname) &&
               Objects.equals(address, customer.address);
    }
    
    @Override
    public int hashCode() {
        return Objects.hash(name, surname, address);
    }
}

/**
 * Represents a rental transaction between a customer and a car.
 */
class Rental {
    private Date rentalDate;
    private Date dueDate;
    private Date backDate;
    private double totalPrice;
    private String leasingTerms;
    private Car car;
    private Customer customer;
    
    /**
     * Default constructor.
     */
    public Rental() {}
    
    // Getters and setters
    public Date getRentalDate() { return rentalDate; }
    public void setRentalDate(Date rentalDate) { this.rentalDate = rentalDate; }
    
    public Date getDueDate() { return dueDate; }
    public void setDueDate(Date dueDate) { this.dueDate = dueDate; }
    
    public Date getBackDate() { return backDate; }
    public void setBackDate(Date backDate) { this.backDate = backDate; }
    
    public double getTotalPrice() { return totalPrice; }
    public void setTotalPrice(double totalPrice) { this.totalPrice = totalPrice; }
    
    public String getLeasingTerms() { return leasingTerms; }
    public void setLeasingTerms(String leasingTerms) { this.leasingTerms = leasingTerms; }
    
    public Car getCar() { return car; }
    public void setCar(Car car) { this.car = car; }
    
    public Customer getCustomer() { return customer; }
    public void setCustomer(Customer customer) { this.customer = customer; }
}

/**
 * Represents an overdue notice sent to customers with late returns.
 */
class OverdueNotice {
    private Customer customer;
    
    /**
     * Default constructor.
     */
    public OverdueNotice() {}
    
    // Getters and setters
    public Customer getCustomer() { return customer; }
    public void setCustomer(Customer customer) { this.customer = customer; }
    
    /**
     * Sends an overdue notice to the specified customer.
     * 
     * @param customer The customer to send the notice to
     */
    public void sendNoticeTo(Customer customer) {
        this.customer = customer;
        // Implementation for sending notice would go here
    }
}