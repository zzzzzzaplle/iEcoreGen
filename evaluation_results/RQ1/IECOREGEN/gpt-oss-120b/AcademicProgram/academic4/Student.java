/**
 * generated by Enhanced EcoreGen
 */
package edu.academic;

import org.eclipse.emf.ecore.EClass;
import org.eclipse.emf.ecore.EObject;

import org.eclipse.emf.ecore.impl.MinimalEObjectImpl;
import java.util.Iterator;
import edu.academic.AcademicFactory;
import edu.academic.Enrollment;

/**
 * <!-- begin-user-doc -->
 * A representation of the model object '<em><b>Student</b></em>'.
 * <!-- end-user-doc -->
 *
 *
 * @see edu.academic.AcademicPackage#getStudent()
 * @model kind="class"
 * @generated
 */
public class Student extends MinimalEObjectImpl.Container implements EObject
{
  /**
   * <!-- begin-user-doc -->
   * <!-- end-user-doc -->
   * @generated
   */
  protected Student()
  {
    super();
  }

  /**
   * <!-- begin-user-doc -->
   * <!-- end-user-doc -->
   * @generated
   */
  @Override
  protected EClass eStaticClass()
  {
    return AcademicPackage.Literals.STUDENT;
  }

  /**
   * <!-- begin-user-doc -->
   * <!-- end-user-doc -->
   * <!-- begin-model-doc -->
   * Summary:
   *   Enrolls the student into the specified course if capacity and business rules allow it.
   * Algorithm:
   *   1. Validate course is not null.
   *   2. Check that the student is not already enrolled:
   *        a. For each Enrollment e in course.enrollments, if e.student == this, abort (throw IllegalStateException).
   *   3. Verify that course.quota > course.enrollments.size(); if not, throw IllegalStateException (no seats).
   *   4. Optionally, verify that the course schedule does not conflict with the student’s existing enrollments (time & day overlap). If conflict, throw IllegalArgumentException.
   *   5. Create a new Enrollment instance:
   *        a. enrollment.grade = 0.0 (or null placeholder).
   *        b. enrollment.Course = course.
   *        c. enrollment.student = this.
   *   6. Add enrollment to course.enrollments.
   * Input:
   *   - course: Course
   *       * Meaning: The course the student wishes to join.
   *       * Constraints: Must be a valid Course object; not null.
   * Output:
   *   - void
   * Preconditions:
   *   - Student object exists.
   *   - Course has a defined quota and enrollment list.
   * Postconditions:
   *   - A new Enrollment linking this student and the course is added to course.enrollments.
   *   - The number of enrolled students for the course increases by one.
   * <!-- end-model-doc -->
   * @model annotation="http://www.ustb.edu.cn/sei/mde/EnhancedCodeGen generated='true'"
   * @generated NOT
   */
  public void enrollInCourse(final Course course)
  {
    // 1. Validate course is not null.
    if (course == null) {
      throw new IllegalArgumentException("Course must not be null.");
    }

    // 2. Ensure the student is not already enrolled.
    for (Enrollment e : course.getEnrollments()) {
      if (e.getStudent() == this) {
        throw new IllegalStateException("Student is already enrolled in the course.");
      }
    }

    // 3. Verify capacity.
    if (course.getQuota() <= course.getEnrollments().size()) {
      throw new IllegalStateException("No seats available in the course.");
    }

    // 4. (Optional schedule conflict check) – omitted as per model guidance.

    // 5. Create and initialise a new Enrollment.
    Enrollment enrollment = AcademicFactory.eINSTANCE.createEnrollment();
    enrollment.setGrade(0.0);
    enrollment.setCourse(course);
    enrollment.setStudent(this);

    // 6. Add the enrollment to the course.
    course.getEnrollments().add(enrollment);
  }

  /**
   * <!-- begin-user-doc -->
   * <!-- end-user-doc -->
   * <!-- begin-model-doc -->
   * Summary:
   *   Removes the student’s enrollment from the specified course, if such enrollment exists.
   * Algorithm:
   *   1. Validate course is not null.
   *   2   Search course.enrollments for an Enrollment e where e.student == this.
   *        a. If not found, throw IllegalStateException (student not enrolled).
   *   2. Remove the found Enrollment e from course.enrollments.
   *   3. Optionally, nullify e references to aid garbage collection.
   * Input:
   *   - course: Course
   *       * Meaning: Course from which the student wants to withdraw.
   *       * Constraints: Must be a valid Course object; not null.
   * Output:
   *   - void
   * Preconditions:
   *   - Student is currently enrolled in the given course.
   * Postconditions:
   *   - The student’s Enrollment entry is removed; course.enrollments size decreases by one.
   *   - No other side effects on other enrollments or courses.
   * <!-- end-model-doc -->
   * @model annotation="http://www.ustb.edu.cn/sei/mde/EnhancedCodeGen generated='true'"
   * @generated NOT
   */
  public void dropCourse(final Course course)
  {
    // 1. Validate course is not null.
    if (course == null) {
      throw new IllegalArgumentException("Course must not be null.");
    }

    // 2. Locate the enrollment belonging to this student.
    Enrollment toRemove = null;
    for (Enrollment e : course.getEnrollments()) {
      if (e.getStudent() == this) {
        toRemove = e;
        break;
      }
    }

    if (toRemove == null) {
      throw new IllegalStateException("Student is not enrolled in the specified course.");
    }

    // 3. Remove the enrollment from the course.
    course.getEnrollments().remove(toRemove);

    // 4. Optional cleanup of references.
    toRemove.setStudent(null);
    toRemove.setCourse(null);
  }

} // Student
