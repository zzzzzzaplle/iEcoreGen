/**
 * generated by Enhanced EcoreGen
 */
package edu.academic;

import org.eclipse.emf.ecore.EClass;
import org.eclipse.emf.ecore.EObject;

import org.eclipse.emf.ecore.impl.MinimalEObjectImpl;
import org.eclipse.emf.common.util.EList;
import edu.academic.AcademicFactory;
import edu.academic.Enrollment;

/**
 * <!-- begin-user-doc -->
 * A representation of the model object '<em><b>Student</b></em>'.
 * <!-- end-user-doc -->
 *
 *
 * @see edu.academic.AcademicPackage#getStudent()
 * @model kind="class"
 * @generated
 */
public class Student extends MinimalEObjectImpl.Container implements EObject
{
  /**
   * <!-- begin-user-doc -->
   * <!-- end-user-doc -->
   * @generated
   */
  protected Student()
  {
    super();
  }

  /**
   * <!-- begin-user-doc -->
   * <!-- end-user-doc -->
   * @generated
   */
  @Override
  protected EClass eStaticClass()
  {
    return AcademicPackage.Literals.STUDENT;
  }

  /**
   * <!-- begin-user-doc -->
   * <!-- end-user-doc -->
   * <!-- begin-model-doc -->
   * Summary:
   *   Attempts to enroll the student in the specified course, respecting quota limits and avoiding duplicate enrollments.
   * Algorithm:
   *   1. Validate that course is non‑null.
   *   2. If the student already has an Enrollment for this course (search course.enrollments for this student),
   *      throw IllegalStateException ("already enrolled").
   *   3. If course.quota <= course.enrollments.size(), throw IllegalStateException ("quota full").
   *   4. Create a new Enrollment instance e:
   *        a. e.student = this.
   *        b. e.Course = course.
   *        c. e.grade = 0.0 (or null to indicate not yet graded).
   *   5. Add e to course.enrollments.
   * Input:
   *   - course: Course
   *       * Meaning: the course the student wishes to join.
   *       * Range: must be a Course object that belongs to an AcademicProgram.
   * Output:
   *   - void
   * Pre‑condition:
   *   - Student is a valid, active entity in the system.
   * Post‑condition:
   *   - The course.enrollments collection contains a new Enrollment linking this student and the course.
   *   - The student's personal schedule (if any) is considered updated implicitly.
   * <!-- end-model-doc -->
   * @model annotation="http://www.ustb.edu.cn/sei/mde/EnhancedCodeGen generated='true'"
   * @generated NOT
   */
  public void enrollInCourse(final Course course)
  {
    if (course == null) {
      throw new IllegalArgumentException("course must not be null");
    }

    // Check for existing enrollment
    for (Enrollment existing : course.getEnrollments()) {
      if (existing.getStudent() == this) {
        throw new IllegalStateException("already enrolled");
      }
    }

    // Check quota
    if (course.getQuota() <= course.getEnrollments().size()) {
      throw new IllegalStateException("quota full");
    }

    // Create new enrollment
    Enrollment e = AcademicFactory.eINSTANCE.createEnrollment();
    e.setStudent(this);
    e.setCourse(course);
    e.setGrade(0.0);

    // Add to course enrollments
    course.getEnrollments().add(e);
  }

  /**
   * <!-- begin-user-doc -->
   * <!-- end-user-doc -->
   * <!-- begin-model-doc -->
   * Summary:
   *   Removes the student's enrollment from the specified course, if such an enrollment exists.
   * Algorithm:
   *   1. Validate that course is non‑null.
   *   2. Locate the Enrollment e in course.enrollments where e.student == this.
   *   3. If not found, throw IllegalStateException ("student not enrolled in the given course").
   *   4. Remove e from course.enrollments.
   * Input:
   *   - course: Course
   *       * Meaning: the course from which the student wants to withdraw.
   * Output:
   *   - void
   * Pre‑condition:
   *   - The student is currently enrolled in the given course.
   * Post‑condition:
   *   - The enrollment linking this student to the course is removed.
   *   - The course's available quota increases by one.
   * <!-- end-model-doc -->
   * @model annotation="http://www.ustb.edu.cn/sei/mde/EnhancedCodeGen generated='true'"
   * @generated NOT
   */
  public void dropCourse(final Course course)
  {
    if (course == null) {
      throw new IllegalArgumentException("course must not be null");
    }

    Enrollment toRemove = null;
    for (Enrollment e : course.getEnrollments()) {
      if (e.getStudent() == this) {
        toRemove = e;
        break;
      }
    }

    if (toRemove == null) {
      throw new IllegalStateException("student not enrolled in the given course");
    }

    course.getEnrollments().remove(toRemove);
  }

} // Student
