/**
 * generated by Enhanced EcoreGen
 */
package edu.academic;

import org.eclipse.emf.ecore.EClass;
import org.eclipse.emf.ecore.EObject;

import org.eclipse.emf.ecore.impl.MinimalEObjectImpl;

/**
 * <!-- begin-user-doc -->
 * A representation of the model object '<em><b>Student</b></em>'.
 * <!-- end-user-doc -->
 *
 *
 * @see edu.academic.AcademicPackage#getStudent()
 * @model kind="class"
 * @generated
 */
public class Student extends MinimalEObjectImpl.Container implements EObject
{
  /**
   * <!-- begin-user-doc -->
   * <!-- end-user-doc -->
   * @generated
   */
  protected Student()
  {
    super();
  }

  /**
   * <!-- begin-user-doc -->
   * <!-- end-user-doc -->
   * @generated
   */
  @Override
  protected EClass eStaticClass()
  {
    return AcademicPackage.Literals.STUDENT;
  }

  /**
   * <!-- begin-user-doc -->
   * <!-- end-user-doc -->
   * <!-- begin-model-doc -->
   * Summary:
   *   Registers the student in the specified course if seats are available and the student is not already enrolled.
   * Algorithm:
   *   1. Verify that `course` is not null.
   *   2. If `course.quota` ≤ `course.enrollments.size()`, abort (throw InsufficientQuotaException).
   *   3. If an Enrollment already exists in `course.enrollments` for this student, abort (throw DuplicateEnrollmentException).
   *   4. Create a new Enrollment `e` with `e.student ← this`, `e.Course ← course`, `e.grade ← 0.0` (placeholder).
   *   5. Add `e` to `course.enrollments`.
   * Input:
   *   - course: Course – the course the student wishes to join.
   * Output:
   *   - void (or throws exception on failure).
   * Pre‑condition:
   *   - Student is not already enrolled in `course`.
   *   - Course quota has at least one free seat.
   * Post‑condition:
   *   - `course.enrollments` contains a new Enrollment linking this student and the course.
   *   - The course’s effective occupancy increases by one.
   * <!-- end-model-doc -->
   * @model annotation="http://www.ustb.edu.cn/sei/mde/EnhancedCodeGen generated='true'"
   * @generated NOT
   */
  public void enrollInCourse(final Course course)
  {
    // 1. Verify that `course` is not null.
    if (course == null) {
      throw new IllegalArgumentException("Course cannot be null.");
    }

    // 2. If `course.quota` ≤ `course.enrollments.size()`, abort (throw InsufficientQuotaException).
    if (course.getQuota() <= course.getEnrollments().size()) {
      throw new IllegalStateException("Course \"" + course.getName() + "\" has no free seats.");
    }

    // 3. If an Enrollment already exists in `course.enrollments` for this student, abort (throw DuplicateEnrollmentException).
    for (Enrollment existing : course.getEnrollments()) {
      if (existing.getStudent() == this) {
        throw new IllegalStateException("Student is already enrolled in course \"" + course.getName() + "\".");
      }
    }

    // 4. Create a new Enrollment `e` with `e.student ← this`, `e.Course ← course`, `e.grade ← 0.0` (placeholder).
    Enrollment e = AcademicFactory.eINSTANCE.createEnrollment();
    e.setStudent(this);
    e.setCourse(course);
    e.setGrade(0.0);

    // 5. Add `e` to `course.enrollments`.
    course.getEnrollments().add(e);
  }

  /**
   * <!-- begin-user-doc -->
   * <!-- end-user-doc -->
   * <!-- begin-model-doc -->
   * Summary:
   *   Removes the student’s enrollment from the specified course, if present.
   * Algorithm:
   *   1. Verify `course` is not null.
   *   2. Search `course.enrollments` for an Enrollment whose `student` equals this Student.
   *   3. If none found, abort (throw EnrollmentNotFoundException).
   *   4. Remove the found Enrollment from `course.enrollments`.
   * Input:
   *   - course: Course – the course to be dropped.
   * Output:
   *   - void (or throws exception on failure).
   * Pre‑condition:
   *   - Student is currently enrolled in `course`.
   * Post‑condition:
   *   - The enrollment linking this Student and `course` is removed.
   *   - The course’s occupied seats decrease by one.
   * <!-- end-model-doc -->
   * @model annotation="http://www.ustb.edu.cn/sei/mde/EnhancedCodeGen generated='true'"
   * @generated NOT
   */
  public void dropCourse(final Course course)
  {
    // 1. Verify `course` is not null.
    if (course == null) {
      throw new IllegalArgumentException("Course cannot be null.");
    }

    // 2. Search `course.enrollments` for an Enrollment whose `student` equals this Student.
    Enrollment toRemove = null;
    for (Enrollment enrollment : course.getEnrollments()) {
      if (enrollment.getStudent() == this) {
        toRemove = enrollment;
        break;
      }
    }

    // 3. If none found, abort (throw EnrollmentNotFoundException).
    if (toRemove == null) {
      throw new IllegalStateException("Student is not enrolled in course \"" + course.getName() + "\".");
    }

    // 4. Remove the found Enrollment from `course.enrollments`.
    course.getEnrollments().remove(toRemove);
  }

} // Student
