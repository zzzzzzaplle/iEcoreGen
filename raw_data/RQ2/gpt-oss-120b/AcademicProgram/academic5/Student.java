/**
 * generated by Enhanced EcoreGen
 */
package edu.academic;

import org.eclipse.emf.ecore.EClass;
import org.eclipse.emf.ecore.EObject;

import org.eclipse.emf.ecore.impl.MinimalEObjectImpl;
import edu.academic.AcademicFactory;
import edu.academic.Enrollment;

/**
 * <!-- begin-user-doc -->
 * A representation of the model object '<em><b>Student</b></em>'.
 * <!-- end-user-doc -->
 *
 *
 * @see edu.academic.AcademicPackage#getStudent()
 * @model kind="class"
 * @generated
 */
public class Student extends MinimalEObjectImpl.Container implements EObject
{
  /**
   * <!-- begin-user-doc -->
   * <!-- end-user-doc -->
   * @generated
   */
  protected Student()
  {
    super();
  }

  /**
   * <!-- begin-user-doc -->
   * <!-- end-user-doc -->
   * @generated
   */
  @Override
  protected EClass eStaticClass()
  {
    return AcademicPackage.Literals.STUDENT;
  }

  /**
   * <!-- begin-user-doc -->
   * <!-- end-user-doc -->
   * <!-- begin-model-doc -->
   * Summary:
   *   Adds the student to the enrollment list of the given course, respecting the course quota.
   * Algorithm:
   *   1. Validate that course is not null.
   *   2. Verify that course.quota > 0; if not, throw IllegalStateException ("No remaining quota").
   *   3. Check if an Enrollment already exists for this student in course.enrollments; if so, abort or throw IllegalArgumentException.
   *   4. Create a new Enrollment object e:
   *        a. e.student = this Student.
   *        b. e.Course   = course.
   *        c. e.grade    = 0.0 (or sentinel value indicating not graded yet).
   *   5. Add e to course.enrollments.
   *   6. Decrease course.quota by 1 (using course.decreaseQuotaBy(1)).
   * Input:
   *   - course: Course – the course the student wishes to enroll in.
   * Output:
   *   - void
   * Pre‑condition:
   *   - The course has at least one remaining quota slot.
   * Post‑condition:
   *   - A new Enrollment linking this student and the course exists.
   *   - Course.quota is reduced by one.
   * <!-- end-model-doc -->
   * @model annotation="http://www.ustb.edu.cn/sei/mde/EnhancedCodeGen generated='true'"
   * @generated NOT
   */
  public void enrollInCourse(final Course course)
  {
    // 1. Validate that course is not null.
    if (course == null) {
      throw new IllegalArgumentException("Course cannot be null");
    }

    // 2. Verify that course.quota > 0.
    if (course.getQuota() <= 0) {
      throw new IllegalStateException("No remaining quota");
    }

    // 3. Check for existing Enrollment for this student.
    for (Enrollment existing : course.getEnrollments()) {
      if (existing.getStudent() == this) {
        throw new IllegalArgumentException("Student is already enrolled in this course");
      }
    }

    // 4. Create a new Enrollment object.
    Enrollment e = AcademicFactory.eINSTANCE.createEnrollment();
    e.setStudent(this);
    e.setCourse(course);
    e.setGrade(0.0);

    // 5. Add the enrollment to the course.
    course.getEnrollments().add(e);

    // 6. Decrease the quota by 1.
    course.decreaseQuotaBy(1);
  }

  /**
   * <!-- begin-user-doc -->
   * <!-- end-user-doc -->
   * <!-- begin-model-doc -->
   * Summary:
   *   Removes the student's enrollment from the specified course, if it exists.
   * Algorithm:
   *   1. Validate that course is not null.
   *   2. Locate the Enrollment e in course.enrollments where e.student == this Student.
   *   3. If e is found:
   *        a. Remove e from course.enrollments.
   *        b. Optionally, delete e (garbage collection will clean it up).
   *   4. If no such enrollment exists, do nothing or raise a NoSuchElementException (design choice).
   * Input:
   *   - course: Course – the course to be dropped.
   * Output:
   *   - void
   * Pre‑condition:
   *   - Student is possibly enrolled in the given course.
   * Post‑condition:
   *   - The student is no longer enrolled in the course; the course.enrollments list no longer contains an entry for this student.
   * <!-- end-model-doc -->
   * @model annotation="http://www.ustb.edu.cn/sei/mde/EnhancedCodeGen generated='true'"
   * @generated NOT
   */
  public void dropCourse(final Course course)
  {
    // 1. Validate that course is not null.
    if (course == null) {
      throw new IllegalArgumentException("Course cannot be null");
    }

    // 2. Locate the Enrollment belonging to this student.
    Enrollment toRemove = null;
    for (Enrollment e : course.getEnrollments()) {
      if (e.getStudent() == this) {
        toRemove = e;
        break;
      }
    }

    // 3. If found, remove it from the course's enrollment list.
    if (toRemove != null) {
      course.getEnrollments().remove(toRemove);
      // Optionally, one could increase the quota again, but the specification does not require it.
    }

    // 4. If not found, do nothing (as per design choice).
  }

} // Student
