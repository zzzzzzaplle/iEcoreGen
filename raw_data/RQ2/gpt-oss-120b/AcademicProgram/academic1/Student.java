/**
 * generated by Enhanced EcoreGen
 */
package edu.academic;

import org.eclipse.emf.ecore.EClass;
import org.eclipse.emf.ecore.EObject;

import org.eclipse.emf.ecore.impl.MinimalEObjectImpl;
import org.eclipse.emf.common.util.EList;
import edu.academic.AcademicFactory;
import edu.academic.Enrollment;

/**
 * <!-- begin-user-doc -->
 * A representation of the model object '<em><b>Student</b></em>'.
 * <!-- end-user-doc -->
 *
 *
 * @see edu.academic.AcademicPackage#getStudent()
 * @model kind="class"
 * @generated
 */
public class Student extends MinimalEObjectImpl.Container implements EObject
{
  /**
   * <!-- begin-user-doc -->
   * <!-- end-user-doc -->
   * @generated
   */
  protected Student()
  {
    super();
  }

  /**
   * <!-- begin-user-doc -->
   * <!-- end-user-doc -->
   * @generated
   */
  @Override
  protected EClass eStaticClass()
  {
    return AcademicPackage.Literals.STUDENT;
  }

  /**
   * <!-- begin-user-doc -->
   * <!-- end-user-doc -->
   * <!-- begin-model-doc -->
   * Summary:
   *   Enrolls the student in the given course, creating a new Enrollment record, provided that the
   *   course has available quota and the student is not already enrolled.
   * Algorithm:
   *   1. Validate course is not null.
   *   2. If this student already has an Enrollment in course.enrollments, throw IllegalArgumentException.
   *   3. Compute currentEnrolled = size of course.enrollments.
   *   4. If currentEnrolled >= course.quota, throw IllegalStateException ("Course quota full").
   *   5. Create new Enrollment e with:
   *        e.student = this,
   *        e.Course = course,
   *        e.grade = 0.0 (or a sentinel indicating “not graded yet”).
   *   6. Add e to course.enrollments.
   * Input:
   *   - course (Course): target course for enrollment.
   * Output:
   *   - void.
   * Pre-condition:
   *   - Course exists and has a defined quota (quota ≥ 0).
   * Post-condition:
   *   - A new Enrollment linking this Student and the Course is added.
   *   - course.enrollments size increased by one.
   * <!-- end-model-doc -->
   * @model annotation="http://www.ustb.edu.cn/sei/mde/EnhancedCodeGen generated='true'"
   * @generated NOT
   */
  public void enrollInCourse(final Course course)
  {
    // 1. Validate course is not null.
    if (course == null) {
      throw new IllegalArgumentException("Course must not be null");
    }

    // 2. Check for existing enrollment of this student in the course.
    EList<Enrollment> enrollments = course.getEnrollments();
    for (Enrollment e : enrollments) {
      if (e.getStudent() == this) {
        throw new IllegalArgumentException("Student already enrolled in the course");
      }
    }

    // 3. Compute currentEnrolled.
    int currentEnrolled = enrollments.size();

    // 4. Verify quota.
    if (currentEnrolled >= course.getQuota()) {
      throw new IllegalStateException("Course quota full");
    }

    // 5. Create new Enrollment.
    Enrollment newEnrollment = AcademicFactory.eINSTANCE.createEnrollment();
    newEnrollment.setStudent(this);
    newEnrollment.setCourse(course);
    newEnrollment.setGrade(0.0); // sentinel for “not graded yet”

    // 6. Add the enrollment to the course.
    enrollments.add(newEnrollment);
  }

  /**
   * <!-- begin-user-doc -->
   * <!-- end-user-doc -->
   * <!-- begin-model-doc -->
   * Summary:
   *   Removes the student from the specified course's enrollment list, if currently enrolled,
   *   and updates both sides of the relationship.
   * Algorithm:
   *   1. Validate course is not null.
   *   2. Search course.enrollments for an Enrollment e where e.student == this.
   *        - If not found, throw IllegalStateException ("Student not enrolled in the course").
   *   3. Remove e from course.enrollments.
   *   4. (Optional) Remove the corresponding Enrollment object from any Student‑side collection
   *        if such a collection existed.
   * Input:
   *   - course (Course): the course to be dropped.
   * Output:
   *   - void.
   * Pre-condition:
   *   - Student is currently enrolled in the given course.
   * Post-condition:
   *   - The enrollment relationship between this Student and the given Course is removed.
   *   - Course.enrollments size decreased by one.
   * <!-- end-model-doc -->
   * @model annotation="http://www.ustb.edu.cn/sei/mde/EnhancedCodeGen generated='true'"
   * @generated NOT
   */
  public void dropCourse(final Course course)
  {
    // 1. Validate course is not null.
    if (course == null) {
      throw new IllegalArgumentException("Course must not be null");
    }

    // 2. Search for the enrollment linking this student and the course.
    EList<Enrollment> enrollments = course.getEnrollments();
    Enrollment toRemove = null;
    for (Enrollment e : enrollments) {
      if (e.getStudent() == this) {
        toRemove = e;
        break;
      }
    }

    // If not found, throw an exception.
    if (toRemove == null) {
      throw new IllegalStateException("Student not enrolled in the course");
    }

    // 3. Remove the enrollment from the course's list.
    enrollments.remove(toRemove);
    // 4. No explicit student‑side collection exists; nothing else to update.
  }

} // Student
