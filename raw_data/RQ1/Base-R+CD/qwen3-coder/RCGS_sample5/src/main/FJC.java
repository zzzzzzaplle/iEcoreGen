import java.util.*;
import java.text.SimpleDateFormat;

/**
 * Store class represents the car rental store.
 * It manages cars, rentals, and overdue notices.
 */
 class Store {
    private List<Car> cars;
    private List<Rental> rentals;
    private List<OverdueNotice> notices;

    /**
     * Default constructor initializes empty lists for cars, rentals, and notices.
     */
    public Store() {
        this.cars = new ArrayList<>();
        this.rentals = new ArrayList<>();
        this.notices = new ArrayList<>();
    }

    /**
     * Getter for cars list.
     * @return List of cars in the store
     */
    public List<Car> getCars() {
        return cars;
    }

    /**
     * Setter for cars list.
     * @param cars List of cars to set
     */
    public void setCars(List<Car> cars) {
        this.cars = cars;
    }

    /**
     * Getter for rentals list.
     * @return List of rentals
     */
    public List<Rental> getRentals() {
        return rentals;
    }

    /**
     * Setter for rentals list.
     * @param rentals List of rentals to set
     */
    public void setRentals(List<Rental> rentals) {
        this.rentals = rentals;
    }

    /**
     * Getter for notices list.
     * @return List of overdue notices
     */
    public List<OverdueNotice> getNotices() {
        return notices;
    }

    /**
     * Setter for notices list.
     * @param notices List of notices to set
     */
    public void setNotices(List<OverdueNotice> notices) {
        this.notices = notices;
    }

    /**
     * Identifies available cars in the store.
     * A car is available if it is not currently rented.
     * Returns a list of available cars, sorted by daily price in ascending order.
     * If no available cars exist, returns an empty list.
     *
     * @return List of available cars sorted by daily price
     */
    public List<Car> identifyAvailableCars() {
        List<Car> availableCars = new ArrayList<>();
        
        // Get all rented car plates
        Set<String> rentedCarPlates = new HashSet<>();
        for (Rental rental : rentals) {
            if (rental.getBackDate() == null) {
                rentedCarPlates.add(rental.getCar().getPlate());
            }
        }
        
        // Check which cars are not rented
        for (Car car : cars) {
            if (!rentedCarPlates.contains(car.getPlate())) {
                availableCars.add(car);
            }
        }
        
        // Sort by daily price
        availableCars.sort(Comparator.comparingDouble(Car::getDailyPrice));
        
        return availableCars;
    }

    /**
     * Calculates the total revenue generated by all rentals in the store.
     *
     * @return Total revenue from all rentals
     */
    public double calculateTotalRevenue() {
        double totalRevenue = 0.0;
        for (Rental rental : rentals) {
            totalRevenue += rental.getTotalPrice();
        }
        return totalRevenue;
    }

    /**
     * Lists customers with overdue rentals.
     * For each rental, if the back date is null and the current date is past the due date,
     * mark it as overdue.
     * Returns an empty list if no overdue customers exist.
     *
     * @param currentDate Current date to compare against due dates
     * @return List of customers with overdue rentals
     */
    public List<Customer> findCustomersWithOverdueRentals(Date currentDate) {
        List<Customer> overdueCustomers = new ArrayList<>();
        
        for (Rental rental : rentals) {
            // Check if rental is active (not returned) and overdue
            if (rental.getBackDate() == null && 
                currentDate != null && 
                rental.getDueDate() != null && 
                currentDate.after(rental.getDueDate())) {
                
                // Check if customer is already in the list
                if (!overdueCustomers.contains(rental.getCustomer())) {
                    overdueCustomers.add(rental.getCustomer());
                }
            }
        }
        
        return overdueCustomers;
    }

    /**
     * Determines the average daily price of cars in the store.
     * Sums the daily prices of all cars and divides by the total number of cars.
     * If the store has no cars, returns 0.0.
     *
     * @return Average daily price of all cars
     */
    public double determineAverageDailyPrice() {
        if (cars.isEmpty()) {
            return 0.0;
        }
        
        double totalDailyPrice = 0.0;
        for (Car car : cars) {
            totalDailyPrice += car.getDailyPrice();
        }
        
        return totalDailyPrice / cars.size();
    }

    /**
     * Counts the number of cars rented per customer.
     * Returns a map of customers and their respective rental counts,
     * or an empty map if no customers have rented cars.
     *
     * @return Map of customers and their rental counts
     */
    public Map<Customer, Integer> countCarsRentedPerCustomer() {
        Map<Customer, Integer> rentalCountMap = new HashMap<>();
        
        for (Rental rental : rentals) {
            Customer customer = rental.getCustomer();
            rentalCountMap.put(customer, rentalCountMap.getOrDefault(customer, 0) + 1);
        }
        
        return rentalCountMap;
    }
}

/**
 * Car class represents a car in the rental store.
 */
class Car {
    private String plate;
    private String model;
    private double dailyPrice;

    /**
     * Default constructor initializes an empty car.
     */
    public Car() {
    }

    /**
     * Getter for plate.
     * @return Plate of the car
     */
    public String getPlate() {
        return plate;
    }

    /**
     * Setter for plate.
     * @param plate Plate to set
     */
    public void setPlate(String plate) {
        this.plate = plate;
    }

    /**
     * Getter for model.
     * @return Model of the car
     */
    public String getModel() {
        return model;
    }

    /**
     * Setter for model.
     * @param model Model to set
     */
    public void setModel(String model) {
        this.model = model;
    }

    /**
     * Getter for dailyPrice.
     * @return Daily price of the car
     */
    public double getDailyPrice() {
        return dailyPrice;
    }

    /**
     * Setter for dailyPrice.
     * @param dailyPrice Daily price to set
     */
    public void setDailyPrice(double dailyPrice) {
        this.dailyPrice = dailyPrice;
    }

    @Override
    public boolean equals(Object obj) {
        if (this == obj) return true;
        if (obj == null || getClass() != obj.getClass()) return false;
        Car car = (Car) obj;
        return Objects.equals(plate, car.plate);
    }

    @Override
    public int hashCode() {
        return Objects.hash(plate);
    }
}

/**
 * Customer class represents a customer of the rental store.
 */
class Customer {
    private String name;
    private String surname;
    private String address;
    private String rentedCarPlate;

    /**
     * Default constructor initializes an empty customer.
     */
    public Customer() {
    }

    /**
     * Getter for name.
     * @return Name of the customer
     */
    public String getName() {
        return name;
    }

    /**
     * Setter for name.
     * @param name Name to set
     */
    public void setName(String name) {
        this.name = name;
    }

    /**
     * Getter for surname.
     * @return Surname of the customer
     */
    public String getSurname() {
        return surname;
    }

    /**
     * Setter for surname.
     * @param surname Surname to set
     */
    public void setSurname(String surname) {
        this.surname = surname;
    }

    /**
     * Getter for address.
     * @return Address of the customer
     */
    public String getAddress() {
        return address;
    }

    /**
     * Setter for address.
     * @param address Address to set
     */
    public void setAddress(String address) {
        this.address = address;
    }

    /**
     * Getter for rentedCarPlate.
     * @return Plate of the rented car
     */
    public String getRentedCarPlate() {
        return rentedCarPlate;
    }

    /**
     * Setter for rentedCarPlate.
     * @param rentedCarPlate Plate of the rented car to set
     */
    public void setRentedCarPlate(String rentedCarPlate) {
        this.rentedCarPlate = rentedCarPlate;
    }

    @Override
    public boolean equals(Object obj) {
        if (this == obj) return true;
        if (obj == null || getClass() != obj.getClass()) return false;
        Customer customer = (Customer) obj;
        return Objects.equals(name, customer.name) && 
               Objects.equals(surname, customer.surname);
    }

    @Override
    public int hashCode() {
        return Objects.hash(name, surname);
    }
}

/**
 * Rental class represents a car rental transaction.
 */
class Rental {
    private Date rentalDate;
    private Date dueDate;
    private Date backDate;
    private double totalPrice;
    private String leasingTerms;
    private Car car;
    private Customer customer;

    /**
     * Default constructor initializes an empty rental.
     */
    public Rental() {
    }

    /**
     * Getter for rentalDate.
     * @return Rental date
     */
    public Date getRentalDate() {
        return rentalDate;
    }

    /**
     * Setter for rentalDate.
     * @param rentalDate Rental date to set
     */
    public void setRentalDate(Date rentalDate) {
        this.rentalDate = rentalDate;
    }

    /**
     * Getter for dueDate.
     * @return Due date
     */
    public Date getDueDate() {
        return dueDate;
    }

    /**
     * Setter for dueDate.
     * @param dueDate Due date to set
     */
    public void setDueDate(Date dueDate) {
        this.dueDate = dueDate;
    }

    /**
     * Getter for backDate.
     * @return Back date
     */
    public Date getBackDate() {
        return backDate;
    }

    /**
     * Setter for backDate.
     * @param backDate Back date to set
     */
    public void setBackDate(Date backDate) {
        this.backDate = backDate;
    }

    /**
     * Getter for totalPrice.
     * @return Total price of the rental
     */
    public double getTotalPrice() {
        return totalPrice;
    }

    /**
     * Setter for totalPrice.
     * @param totalPrice Total price to set
     */
    public void setTotalPrice(double totalPrice) {
        this.totalPrice = totalPrice;
    }

    /**
     * Getter for leasingTerms.
     * @return Leasing terms
     */
    public String getLeasingTerms() {
        return leasingTerms;
    }

    /**
     * Setter for leasingTerms.
     * @param leasingTerms Leasing terms to set
     */
    public void setLeasingTerms(String leasingTerms) {
        this.leasingTerms = leasingTerms;
    }

    /**
     * Getter for car.
     * @return Rented car
     */
    public Car getCar() {
        return car;
    }

    /**
     * Setter for car.
     * @param car Rented car to set
     */
    public void setCar(Car car) {
        this.car = car;
    }

    /**
     * Getter for customer.
     * @return Customer who rented the car
     */
    public Customer getCustomer() {
        return customer;
    }

    /**
     * Setter for customer.
     * @param customer Customer to set
     */
    public void setCustomer(Customer customer) {
        this.customer = customer;
    }
}

/**
 * OverdueNotice class represents an overdue notice sent to a customer.
 */
class OverdueNotice {
    private Customer customer;

    /**
     * Default constructor initializes an empty overdue notice.
     */
    public OverdueNotice() {
    }

    /**
     * Getter for customer.
     * @return Customer associated with this notice
     */
    public Customer getCustomer() {
        return customer;
    }

    /**
     * Setter for customer.
     * @param customer Customer to set
     */
    public void setCustomer(Customer customer) {
        this.customer = customer;
    }

    /**
     * Sends an overdue notice to a customer.
     *
     * @param customer Customer to send the notice to
     */
    public void sendNoticeTo(Customer customer) {
        this.customer = customer;
        // In a real implementation, this would send an actual notice
        System.out.println("Overdue notice sent to: " + customer.getName() + " " + customer.getSurname());
    }
}